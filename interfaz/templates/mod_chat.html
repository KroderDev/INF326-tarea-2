{% extends "base.html" %}

{% block title %}Gestionar canales{% endblock %}
{% block body_class %}bg-hero{% endblock %}

{% block content %}
<section class="section stack-lg">
  <div class="card">
    <h2 class="section-title">Crear canal</h2>
    {% if Err_create %}
      <p class="error">Error creando el canal. {{ Err_del }}</p>
    {% endif %}
    <form method="POST" class="stack">
      {% csrf_token %}
      <input type="hidden" name="action" value="create">

      <div class="field">
        <label for="new_name">Nombre</label>
        <input id="new_name" type="text" name="new_name" placeholder="Nombre" required>
      </div>

      <div class="field">
        <label for="new_type">Tipo</label>
        <select id="new_type" name="new_type">
            <option value="public">Público</option>
            <option value="private">Privado</option>
        </select>
      </div>

      <button class="btn btn-primary">Guardar</button>
    </form>
  </div>

  <div class="card stack">
    <h2 class="section-title">Mis canales</h2>
    {% if Err_mod %}<p class="error">Error modificando el canal. {{ Err_mod }}</p>{% endif %}
    {% if Err_del %}<p class="error">Error eliminando el canal. {{ Err_del }}</p>{% endif %}
    {% if Err_add %}<p class="error">Error agregando usuario. {{ Err_add }}</p>{% endif %}
    {% if Err_del_u %}<p class="error">Error eliminando usuario. {{ Err_del_u }}</p>{% endif %}

    {% for chat in Chats %}
      <div class="card card--list stack">
        <div class="header-row">
          <span class="section-title">{{ chat }}</span>
          <form method="POST">
            {% csrf_token %}
            <input type="hidden" name="chat" value="{{ chat }}">
            <input type="hidden" name="action" value="delete">
            <button class="btn btn-danger btn-small" type="submit">Eliminar</button>
          </form>
        </div>

        <form method="POST" class="stack">
          {% csrf_token %}
          <input type="hidden" name="chat" value="{{ chat }}">
          <input type="hidden" name="action" value="rename">

          <div class="field">
            <label>Nuevo nombre</label>
            <input type="text" name="new_name" placeholder="Nuevo nombre..." required>
          </div>

          <div class="field">
            <label>Tipo</label>
            <select name="new_type">
                <option value="public">Público</option>
                <option value="private">Privado</option>
            </select>
          </div>

          <button class="btn btn-primary btn-small" type="submit">Cambiar</button>
        </form>

        <form method="POST" class="stack">
          {% csrf_token %}
          <input type="hidden" name="chat" value="{{ chat }}">

          <div class="field">
            <label>ID usuario</label>
            <input type="text" name="user_id" placeholder="ID usuario" required>
          </div>

          <div class="header-row">
            <button type="submit" name="action" value="add_user" class="btn btn-primary btn-small">Agregar</button>
            <button type="submit" name="action" value="remove_user" class="btn btn-danger btn-small">Eliminar</button>
          </div>
        </form>
      </div>
    {% empty %}
      <p class="empty">No hay chats disponibles.</p>
    {% endfor %}
  </div>
</section>
{% endblock %}
