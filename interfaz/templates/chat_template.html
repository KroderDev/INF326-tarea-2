{% extends "base.html" %}

{% block title %}Chat{% endblock %}

{% block styles %}
<style>
  :root{
    --bg:#f5f7fb;
    --card:#fff;
    --muted:#6b7280;
    --accent:#2563eb;
  }

  body{
    font-family:Inter,system-ui,Arial,sans-serif;
    background:var(--bg);
    margin:0;
  }

  .chat-wrapper{
    max-width:620px;
    margin:40px auto;
    padding:0 20px;
  }

  h1{
    text-align:center;
    margin-bottom:8px;
  }

  h3{
    text-align:center;
    color:var(--muted);
    margin-top:0;
    margin-bottom:22px;
  }

  .messages-box{
    background:var(--card);
    border-radius:12px;
    padding:20px;
    box-shadow:0 4px 20px rgba(16,24,40,.08);
    max-height:500px;
    overflow-y:auto;
  }

  .msg{
    margin-bottom:18px;
    display:flex;
    flex-direction:column;
    max-width:80%;
  }

  .you{
    align-self:flex-end;
    text-align:right;
  }

  .bot{
    align-self:flex-start;
  }

  .sender{
    font-size:0.85rem;
    color:var(--muted);
    margin-bottom:4px;
  }

  .bubble{
    background:#e1e8f7;
    padding:12px 15px;
    border-radius:14px;
    font-size:0.95rem;
    line-height:1.42;
    white-space:pre-wrap;
  }

  .you .bubble{
    background:var(--accent);
    color:white;
  }

  .send-box{
    margin-top:18px;
    display:flex;
    gap:10px;
  }

  .send-box input{
    flex:1;
    padding:14px 16px;
    font-size:1rem;
    border-radius:10px;
    border:1px solid #d1d5db;
  }

  .send-box button{
    padding:0 18px;
    background:var(--accent);
    color:white;
    border:0;
    border-radius:10px;
    cursor:pointer;
    font-size:1rem;
    transition:.15s;
  }

  .send-box button:hover{
    opacity:.9;
    transform:translateY(-1px);
  }
</style>
{% endblock %}

{% block content %}

<div class="chat-wrapper">
  <h1>{{ tipo }}</h1>

  <div class="messages-box" id="msgBox">
    {% for msg in historial %}
      <div class="msg {% if msg.sender == 'user' %}you{% else %}bot{% endif %}">
        <span class="sender">{{ msg.sender|capfirst }}</span>
        <div class="bubble">{{ msg.text }}</div>
      </div>
    {% endfor %}
  </div>

  <form method="POST" class="send-box">
    {% csrf_token %}
    <input type="text" name="mensaje" placeholder="Escribe un mensaje..." required>
    <button type="submit">Enviar</button>
  </form>
</div>

<script>
  const box = document.getElementById("msgBox");
  box.scrollTop = box.scrollHeight;
</script>

{% endblock %}

